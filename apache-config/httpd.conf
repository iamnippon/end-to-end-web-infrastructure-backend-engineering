# ============================================
# Apache HTTP Server Configuration
# End-to-End Web Infrastructure Project
# ============================================

ServerRoot "/usr/local/apache2"

Listen 80
Listen 443

ServerAdmin admin@example.com
ServerName localhost

# --------------------------------------------
# Load Required Modules
# --------------------------------------------

LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule ssl_module modules/mod_ssl.so
LoadModule headers_module modules/mod_headers.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule php_module modules/libphp.so

# --------------------------------------------
# Security Hardening
# --------------------------------------------

ServerTokens Prod
ServerSignature Off
TraceEnable Off

<Directory />
    AllowOverride None
    Require all denied
</Directory>

# --------------------------------------------
# Document Root Configuration
# --------------------------------------------

DocumentRoot "/var/www/html"

<Directory "/var/www/html">
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
</Directory>

# --------------------------------------------
# PHP Integration
# --------------------------------------------

AddType application/x-httpd-php .php
DirectoryIndex index.php index.html

# --------------------------------------------
# Logging
# --------------------------------------------

ErrorLog "logs/error_log"
LogLevel warn

CustomLog "logs/access_log" combined

# --------------------------------------------
# Virtual Host (HTTP)
# --------------------------------------------

<VirtualHost *:80>
    ServerName example.local
    DocumentRoot "/var/www/example"

    <Directory "/var/www/example">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog "logs/example_error.log"
    CustomLog "logs/example_access.log" combined
</VirtualHost>

# --------------------------------------------
# SSL Configuration (HTTPS)
# --------------------------------------------

<VirtualHost *:443>
    ServerName example.local
    DocumentRoot "/var/www/example"

    SSLEngine on
    SSLCertificateFile "/usr/local/apache2/conf/server.crt"
    SSLCertificateKeyFile "/usr/local/apache2/conf/server.key"

    <Directory "/var/www/example">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"

    ErrorLog "logs/ssl_error.log"
    CustomLog "logs/ssl_access.log" combined
</VirtualHost>

# --------------------------------------------
# Performance Optimization
# --------------------------------------------

KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5

<IfModule deflate_module>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript
</IfModule>

# --------------------------------------------
# URL Rewriting (Clean URLs)
# --------------------------------------------

<IfModule rewrite_module>
    RewriteEngine On
</IfModule>
